#!/bin/bash
set -eEu
set -o pipefail

################################################################################
# Run the test harness.
# Invoke from the root of the git repo as "ci/test".
################################################################################

. ci/bootstrap

main() {
  run_precommit
  try_precommit
}

run_precommit() {
  echo '[INFO] Run pre-commit against all files' >&2
  pre-commit run --all-files --verbose
}

try_precommit() {
  echo '[INFO] Try local hooks that require prereqs' >&2
  checks='
    fasterer
  '
  for check in ${checks}; do
    pre-commit try-repo ./ "${check}" --all-files --verbose
  done
}

main
